C51 COMPILER V9.60.7.0   MAIN                                                              06/12/2023 22:26:52 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: E:\keil5_MDKorC51\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listin
                    -gs\main.lst) OBJECT(.\Objects\main.obj)

line level    source

   1          #include "main.h"
   2          
   3          unsigned char KeyNum = 0;         // æ¥æ”¶çŸ©é˜µé”®ç›˜è¿”å›çš„å€¼
   4          unsigned char keyboard_Count = 0; // è®°å½•é”®ç›˜è¾“å…¥æ¬¡æ•°
   5          unsigned char Password_Count = 0; // è®°å½•å¯†ç è¾“å…¥æ¬¡æ•°
   6          unsigned int Password = 0;        // ä¿å­˜è¾“å…¥çš„å¯†ç 
   7          unsigned int Password_decide = 0; // ä¿å­˜æ­£ç¡®å¯†ç 
   8          unsigned int T0Count;             // å®šæ—¶å™¨è®¡æ•°å™¨
   9          bit isS15 = 0;                    // åˆ¤æ–­S15æŒ‰é”®æ˜¯å¦è¢«æŒ‰ä¸‹è¿‡
  10          bit isCorrect = 0;                // ä¿å­˜ç¡®è®¤é”®æ˜¯å¦è¢«æŒ‰ä¸‹ï¼ŒæŒ‰ä¸‹åˆ™ç½®1
  11          
  12          /*
  13          ** è¯»å‡ºAT24C02çš„æ•°æ®ï¼Œå¦‚æœæ²¡æœ‰æ•°æ®åˆ™èµ‹é»˜è®¤å¯†ç ç»™Password_decide
  14          */
  15          void passwordInit()
  16          {
  17   1          // ä»at24c02è¯»å–ä¿å­˜çš„å¯†ç ï¼Œå¦‚æœæ²¡æœ‰ä¿å­˜çš„å¯†ç å°±èµ‹å€¼1234
  18   1          if (AT24C02_readByte(1) != 0xff && AT24C02_readByte(2) != 0xff)
  19   1          {
  20   2              Password_decide = 0;
  21   2              Password_decide |= AT24C02_readByte(1) << 8; // æŠŠé«˜å…«ä½å·¦ç§»å…«ä½ï¼ˆè¶…å‡ºèŒƒå›´åæ•°æ®ä¸
             -ä¼šé”€æ¯ï¼Œåªæ˜¯å¾€æ›´é«˜ä½ç§»ï¼‰åæŒ‰ä½æˆ–ä¸ŠNum
  22   2              Password_decide |= AT24C02_readByte(2);      // ä¸èƒ½ç›´æ¥èµ‹å€¼ï¼Œä¹Ÿè¦æŒ‰ä½æˆ–ä¸Šä½å…«ä½ï¼
             -Œå¦‚æœè¿™å¥å†™åœ¨å‰é¢å°±ä¸ç”¨æˆ–
  23   2          }
  24   1          else
  25   1          {
  26   2              Password_decide = 1234; // åˆå§‹é»˜è®¤å¯†ç 
  27   2          }
  28   1      }
  29          
  30          /*
  31          ** åˆ¤æ–­æ˜¯å¦ä¿å­˜å¯†ç 
  32          */
  33          void isSave()
  34          {
  35   1          AT24C02_writeByte(1, Password / 256); // passwordé«˜å…«ä½ä¿å­˜åœ¨åœ°å€1
  36   1          Delay(5);
  37   1          AT24C02_writeByte(2, Password % 256); // passwordä½å…«ä½ä¿å­˜åœ¨åœ°å€2
  38   1          Delay(5);
  39   1          if (AT24C02_readByte(1) != 0xff && AT24C02_readByte(2) != 0xff)
  40   1          {
  41   2              LCD_ShowString(2, 1, "Save success!");
  42   2          }
  43   1          else
  44   1          {
  45   2              LCD_ShowString(2, 1, "Save error!");
  46   2          }
  47   1          Delay(2000);
  48   1          Password = 0;
  49   1          keyboard_Count = 0;
  50   1      }
  51          
  52          /*
C51 COMPILER V9.60.7.0   MAIN                                                              06/12/2023 22:26:52 PAGE 2   

  53          ** æ¸…ç©ºAT24C02ä¿å­˜çš„å€¼
  54          */
  55          void AT24C02Init()
  56          {
  57   1          AT24C02_writeByte(1, 0xff);
  58   1          Delay(5);
  59   1          AT24C02_writeByte(2, 0xff);
  60   1          Delay(5);
  61   1      }
  62          
  63          /*
  64          ** è¾“å…¥å¯†ç 
  65          */
  66          void inputPassword()
  67          {
  68   1          if (keyboard_Count < 4) // åªèƒ½è¾“å…¥å››ä½å¯†ç 
  69   1          {
  70   2              Password *= 10;          // å¯†ç å·¦ç§»ä¸€ä½
  71   2              Password += KeyNum % 10; // ä¸‹ä¸€ä½å¯†ç è¾“å…¥ï¼Œ10ä½œä¸º0ï¼Œ10æ¨¡10å°±æ˜¯0
  72   2              keyboard_Count++;        // é”®ç›˜è®¡æ¬¡å¢åŠ 
  73   2          }
  74   1      }
  75          
  76          /*
  77          ** åˆ¤æ–­å¯†ç æ˜¯å¦æ­£ç¡®
  78          */
  79          void isPassword()
  80          {
  81   1          if (Password == Password_decide) // åˆ¤æ–­å¯†ç æ˜¯å¦æ­£ç¡®
  82   1          {
  83   2              Password = 0;
  84   2              keyboard_Count = 0;
  85   2              Password_Count = 0;
  86   2              isCorrect = 1;
  87   2      
  88   2              LCD_ShowString(2, 1, "Password, OK");
  89   2              Timer0_Init();
  90   2          }
  91   1          else
  92   1          {
  93   2              Password_Count++; // è¦æ˜¯è¾“å…¥é”™è¯¯å°±è®¡æ¬¡ï¼Œè¶…è¿‡ä¸‰æ¬¡å°±æŠ¥è­¦
  94   2              Password = 0;     // å¦‚æœè¾“å…¥é”™è¯¯ï¼Œå¯†ç ä¸è®¡æ•°å™¨éƒ½æ¸…é›¶ï¼Œé‡æ–°è¾“å…¥
  95   2              keyboard_Count = 0;
  96   2      
  97   2              LCD_ShowString(2, 1, "Password, NO");
  98   2              beep_alarm(1000, 10); // é”™ä¸€æ¬¡å°±å“ä¸€æ¬¡èœ‚é¸£å™¨
  99   2          }
 100   1      }
 101          
 102          /*
 103          ** åˆ é™¤ä¸€ä½å¯†ç 
 104          */
 105          void isDelete()
 106          {
 107   1          if (keyboard_Count > 0)
 108   1          {
 109   2              Password /= 10;   // å¯†ç åˆ é™¤ä¸€ä½
 110   2              keyboard_Count--; // è®¡æ•°å‡å°‘ä¸€æ¬¡
 111   2          }
 112   1      }
 113          
 114          void PasswordModel()
C51 COMPILER V9.60.7.0   MAIN                                                              06/12/2023 22:26:52 PAGE 3   

 115          {
 116   1          // æ­£å¸¸æ¨¡å¼
 117   1          if (isCorrect == 0)
 118   1          {
 119   2              // s13ä½œä¸ºç¡®è®¤é”®
 120   2              if (KeyNum == 13)
 121   2              {
 122   3                  isPassword();
 123   3              }
 124   2              LCD_ShowNumber(1, 10, Password);
 125   2          }
 126   1          // ä¿®æ”¹å¯†ç æ¨¡å¼
 127   1          else if (KeyNum == 15 && isCorrect == 1)
 128   1          {
 129   2              isS15 = 1;
 130   2              TR0 = 0; // åœæ­¢å®šæ—¶å™¨è®¡æ—¶
 131   2              T0Count = 0;
 132   2              LCD_ShowString(1, 1, "Alter password:");
 133   2      
 134   2              // s16ä½œä¸ºç¡®è®¤ä¿å­˜é”®
 135   2              LCD_ShowNumber(2, 1, Password);
 136   2              LCD_ShowString(2, 5, "        ");
 137   2          }
 138   1          else
 139   1          {
 140   2              if (isCorrect == 0)
 141   2              {
 142   3                  LCD_ShowNumber(1, 10, Password);
 143   3                  LCD_ShowString(2, 1, "Password, OK");
 144   3              }
 145   2              if (isS15 == 1)
 146   2              {
 147   3                  LCD_ShowNumber(2, 1, Password);
 148   3              }
 149   2          }
 150   1      }
 151          
 152          int main(void)
 153          {
 154   1          // AT24C02Init();
 155   1          LCD1602_Init();
 156   1          LCD_ShowString(1, 1, "Password:");
 157   1          LCD_ShowString(2, 1, "                ");
 158   1          passwordInit();
 159   1      
 160   1          for (;;)
 161   1          {
 162   2              // æ¥æ”¶çŸ©é˜µé”®ç›˜è¿”å›çš„å€¼
 163   2              KeyNum = MatrixKey();
 164   2              // å¯†ç æ¨¡å¼
 165   2              PasswordModel();
 166   2              // é”®ç›˜å€¼ä¸èƒ½è¶…è¿‡10ä¸”ä¸èƒ½ä¸º0
 167   2              if (KeyNum != 0 && KeyNum <= 10)
 168   2              {
 169   3                  inputPassword();
 170   3              }
 171   2              // s14ä½œä¸ºåˆ é™¤é”®
 172   2              if (KeyNum == 14)
 173   2              {
 174   3                  isDelete();
 175   3              }
 176   2              if (KeyNum == 16 && isS15 == 1)
C51 COMPILER V9.60.7.0   MAIN                                                              06/12/2023 22:26:52 PAGE 4   

 177   2              {
 178   3                  isS15 = 0;
 179   3                  isCorrect = 0;
 180   3                  isSave();
 181   3                  passwordInit();
 182   3                  goto Break;
 183   3              }
 184   2              // å®šæ—¶å™¨å¯åŠ¨åå¦‚æœè¶…è¿‡ä¸‰ç§’æœªæœ‰åŠ¨ä½œåˆ™ç»“æŸç¨‹åº
 185   2              if (T0Count >= 3000)
 186   2              {
 187   3                  TR0 = 0; // åœæ­¢å®šæ—¶å™¨è®¡æ—¶
 188   3                  T0Count = 0;
 189   3                  goto Break;
 190   3              }
 191   2              // å¯†ç é”™è¯¯ä¸‰æ¬¡èœ‚é¸£å™¨è­¦æŠ¥
 192   2              if (Password_Count >= 3)
 193   2              {
 194   3                  beep_alarm(1000, 10);
 195   3              }
 196   2          }
 197   1      Break:
 198   1          return 0;
 199   1      }
 200          
 201          void Timer0_Routine() interrupt 1
 202          {
 203   1          TL0 = 0x66;
 204   1          TH0 = 0xFC;
 205   1          T0Count++;
 206   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    558    ----
   CONSTANT SIZE    =    104    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      9    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      2    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
