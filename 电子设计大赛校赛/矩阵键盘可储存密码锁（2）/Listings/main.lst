C51 COMPILER V9.60.7.0   MAIN                                                              06/13/2023 14:15:47 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: E:\keil5_MDKorC51\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listin
                    -gs\main.lst) OBJECT(.\Objects\main.obj)

line level    source

   1          #include "main.h"
   2          
   3          unsigned char KeyNum = 0;         // æ¥æ”¶çŸ©é˜µé”®ç›˜è¿”å›çš„å€¼
   4          unsigned char keyboard_Count = 0; // è®°å½•é”®ç›˜è¾“å…¥æ¬¡æ•°
   5          unsigned char Password_Count = 0; // è®°å½•å¯†ç è¾“å…¥æ¬¡æ•°
   6          unsigned int Password = 0;        // ä¿å­˜è¾“å…¥çš„å¯†ç 
   7          unsigned int True_password = 0;   // ä¿å­˜æ­£ç¡®å¯†ç 
   8          unsigned int T0Count;             // å®šæ—¶å™¨è®¡æ•°å™¨
   9          bit isCorrect = 0;                // åˆ¤æ–­å¯†ç æ˜¯å¦æ­£ç¡®ï¼Œæ­£ç¡®åˆ™ç½®1
  10          bit keyboard_Off = 0;             // åˆ¤æ–­æ˜¯å¦ç¦ç”¨é”®ç›˜
  11          
  12          /*
  13          ** è¯»å‡ºå­˜åœ¨AT24C02çš„å¯†ç ï¼Œå¦‚æœæ²¡æœ‰å¯†ç åˆ™èµ‹é»˜è®¤å¯†ç ç»™True_password
  14          */
  15          void ReadPassword()
  16          {
  17   1          // ä»at24c02è¯»å–ä¿å­˜çš„å¯†ç ï¼Œå¦‚æœæ²¡æœ‰ä¿å­˜çš„å¯†ç å°±èµ‹å€¼1234
  18   1          if (AT24C02_readByte(1) != 0xff && AT24C02_readByte(2) != 0xff)
  19   1          {
  20   2              True_password = 0;
  21   2              True_password |= AT24C02_readByte(1) << 8; // æŠŠé«˜å…«ä½å·¦ç§»å…«ä½ï¼ˆè¶…å‡ºèŒƒå›´åæ•°æ®ä¸ä
             -¼šé”€æ¯ï¼Œåªæ˜¯å¾€æ›´é«˜ä½ç§»ï¼‰åæŒ‰ä½æˆ–ä¸ŠNum
  22   2              True_password |= AT24C02_readByte(2);      // ä¸èƒ½ç›´æ¥èµ‹å€¼ï¼Œä¹Ÿè¦æŒ‰ä½æˆ–ä¸Šä½å…«ä½ï¼Œå
             -¦‚æœè¿™å¥å†™åœ¨å‰é¢å°±ä¸ç”¨æˆ–
  23   2          }
  24   1          else
  25   1          {
  26   2              True_password = 1234; // åˆå§‹é»˜è®¤å¯†ç 
  27   2          }
  28   1      }
  29          
  30          /*
  31          ** å†™å…¥å¯†ç 
  32          */
  33          void WritePassword()
  34          {
  35   1          AT24C02_writeByte(1, Password / 256); // passwordé«˜å…«ä½ä¿å­˜åœ¨åœ°å€1
  36   1          Delay(5);
  37   1          AT24C02_writeByte(2, Password % 256); // passwordä½å…«ä½ä¿å­˜åœ¨åœ°å€2
  38   1          Delay(5);
  39   1          if (AT24C02_readByte(1) != 0xff && AT24C02_readByte(2) != 0xff)
  40   1          {
  41   2              LCD_ShowString(2, 1, "Save success!");
  42   2          }
  43   1          else
  44   1          {
  45   2              LCD_ShowString(2, 1, "Save error!");
  46   2          }
  47   1          Delay(2000);
  48   1      }
  49          
  50          /*
  51          ** æ¸…ç©ºAT24C02ä¿å­˜çš„å€¼
  52          */
C51 COMPILER V9.60.7.0   MAIN                                                              06/13/2023 14:15:47 PAGE 2   

  53          void AT24C02Init()
  54          {
  55   1          AT24C02_writeByte(1, 0xff);
  56   1          Delay(5);
  57   1          AT24C02_writeByte(2, 0xff);
  58   1          Delay(5);
  59   1      }
  60          
  61          /*
  62          ** è¾“å…¥å¯†ç 
  63          */
  64          void inputPassword()
  65          {
  66   1          if (keyboard_Count < 4) // åªèƒ½è¾“å…¥å››ä½å¯†ç 
  67   1          {
  68   2              Password *= 10;          // å¯†ç å·¦ç§»ä¸€ä½
  69   2              Password += KeyNum % 10; // ä¸‹ä¸€ä½å¯†ç è¾“å…¥ï¼Œ10ä½œä¸º0ï¼Œ10æ¨¡10å°±æ˜¯0
  70   2              keyboard_Count++;        // é”®ç›˜è®¡æ¬¡å¢åŠ 
  71   2          }
  72   1      }
  73          
  74          /*
  75          ** åˆ¤æ–­å¯†ç æ˜¯å¦æ­£ç¡®
  76          */
  77          void isPassword()
  78          {
  79   1          if (Password == True_password) // åˆ¤æ–­å¯†ç æ˜¯å¦æ­£ç¡®
  80   1          {
  81   2              // Password = 0;
  82   2              keyboard_Count = 0;
  83   2              Password_Count = 0;
  84   2              isCorrect = 1;
  85   2              keyboard_Off = 1; // è¾“å…¥æ­£ç¡®åˆ™ç¦ç”¨é”®ç›˜ï¼Œåªæœ‰åœ¨ä¿®æ”¹å¯†ç æ¨¡å¼æ‰å†æ¬¡æ‰“å¼€é”®ç›
             -˜
  86   2      
  87   2              Timer0_Init(); // å¼€å¯å®šæ—¶å™¨
  88   2          }
  89   1          else
  90   1          {
  91   2              Password_Count++; // è¦æ˜¯è¾“å…¥é”™è¯¯å°±è®¡æ¬¡ï¼Œè¶…è¿‡ä¸‰æ¬¡å°±æŠ¥è­¦
  92   2              Password = 0;     // å¦‚æœè¾“å…¥é”™è¯¯ï¼Œå¯†ç ä¸è®¡æ•°å™¨éƒ½æ¸…é›¶ï¼Œé‡æ–°è¾“å…¥
  93   2              keyboard_Count = 0;
  94   2      
  95   2              LCD_ShowString(2, 1, "Password, NO");
  96   2              beep_alarm(1000, 10); // é”™ä¸€æ¬¡å°±å“ä¸€æ¬¡èœ‚é¸£å™¨
  97   2          }
  98   1      }
  99          
 100          /*
 101          ** åˆ é™¤ä¸€ä½å¯†ç 
 102          */
 103          void isDelete()
 104          {
 105   1          if (keyboard_Count > 0)
 106   1          {
 107   2              Password /= 10;   // å¯†ç åˆ é™¤ä¸€ä½
 108   2              keyboard_Count--; // è®¡æ•°å‡å°‘ä¸€æ¬¡
 109   2          }
 110   1      }
 111          
 112          bit PasswordModel()
 113          {
C51 COMPILER V9.60.7.0   MAIN                                                              06/13/2023 14:15:47 PAGE 3   

 114   1          unsigned char S15_count = 0; // è®°å½•S15è¢«æŒ‰ä¸‹å‡ æ¬¡
 115   1      
 116   1          /************************************ public *************************************/
 117   1          // é”®ç›˜å€¼ä¸èƒ½è¶…è¿‡10ä¸”ä¸èƒ½ä¸º0ä¸”é”®ç›˜æœªè¢«ç¦ç”¨
 118   1          if (KeyNum != 0 && KeyNum <= 10 && keyboard_Off == 0)
 119   1          {
 120   2              inputPassword();
 121   2          }
 122   1          // s14ä½œä¸ºåˆ é™¤é”®
 123   1          if (KeyNum == 14)
 124   1          {
 125   2              isDelete();
 126   2          }
 127   1          // å¯†ç é”™è¯¯ä¸‰æ¬¡èœ‚é¸£å™¨è­¦æŠ¥
 128   1          if (Password_Count >= 3)
 129   1          {
 130   2              beep_alarm(1000, 10);
 131   2          }
 132   1          /********************************* å…±ç”¨çš„æŒ‰é”®å‡½æ•° ***********************************/
 133   1      
 134   1          /********************************* æ‰§è¡Œé€€å‡ºæ¡ä»¶çš„å‡½æ•° *******************************/
 135   1          // ä¿®æ”¹å¯†ç æ¨¡å¼ï¼Œè¾“å…¥æ­£ç¡®å¯†ç isCorrectç½®1åæ‰èƒ½è¿›å…¥è¿™ä¸ªæ¨¡å¼
 136   1          if (KeyNum == 15 && isCorrect == 1)
 137   1          {
 138   2              S15_count++; // ä¸€æ¬¡åˆ™æ˜¯æ­£å¸¸ä¿®æ”¹æ¨¡å¼ï¼Œ
 139   2              TR0 = 0;     // åœæ­¢å®šæ—¶å™¨è®¡æ—¶
 140   2              T0Count = 0;
 141   2              Password = 0;
 142   2              Password_Count = 0;
 143   2              keyboard_Off = 0;
 144   2      
 145   2              LCD1602_WriteCommand(0x01); // æ¸…å±
 146   2          }
 147   1          // s16ä½œä¸ºä¿å­˜ä¿®æ”¹å0å¯†ç çš„æŒ‰é”®
 148   1          // ä¿å­˜åç¨‹åºä¹Ÿè‡ªåŠ¨é€€å‡º
 149   1          if (KeyNum == 16 && S15_count == 1)
 150   1          {
 151   2              // æŒ‰ä¸‹ä¿å­˜ä¿®æ”¹å¯†ç æŒ‰é”®è¿‡åï¼Œæ‰€æœ‰æ ‡å¿—ä½æ¢å¤é»˜è®¤å€¼ï¼Œæ‰§è¡Œä¿å­˜å‡½æ•°
 152   2              S15_count = 0;
 153   2              isCorrect = 0;
 154   2              WritePassword();
 155   2              ReadPassword();
 156   2              return 1;
 157   2          }
 158   1          /***********************************************************************************/
 159   1      
 160   1          // æ­£å¸¸æ¨¡å¼
 161   1          if (isCorrect == 0)
 162   1          {
 163   2              // s13ä½œä¸ºç¡®è®¤é”®
 164   2              if (KeyNum == 13)
 165   2              {
 166   3                  // æ‰§è¡Œåˆ¤æ–­å¯†ç å¸ˆæ˜¯å¦æ­£ç¡®å‡½æ•°ï¼Œå¦‚æœå¯†ç æ­£ç¡®åˆ™isCorrectè¢«ç½®1ï¼Œä¸æ­£ç¡®
             -åˆ™ä¸€ç›´å¾ªç¯
 167   3                  isPassword();
 168   3              }
 169   2              LCD_ShowNumber(1, 10, Password);
 170   2          }
 171   1          // è¾“å…¥æ­£ç¡®æ¨¡å¼
 172   1          else
 173   1          {
 174   2              // å¯†ç è¾“å…¥æ­£ç¡®ä½†æ— åŠ¨ä½œ
C51 COMPILER V9.60.7.0   MAIN                                                              06/13/2023 14:15:47 PAGE 4   

 175   2              if (S15_count == 0)
 176   2              {
 177   3                  LCD_ShowNumber(1, 10, Password);
 178   3                  LCD_ShowString(2, 1, "Password, OK");
 179   3              }
 180   2              // å¯†ç è¾“å…¥æ­£ç¡®å¹¶ä¸”æŒ‰ä¸‹s15è¿›å…¥ä¿®æ”¹å¯†ç æ¨¡å¼
 181   2              if (S15_count == 1)
 182   2              {
 183   3                  // æ˜¾ç¤ºä¿®æ”¹å¯†ç çš„UI
 184   3                  LCD_ShowString(1, 1, "Alter password:");
 185   3                  LCD_ShowNumber(2, 1, Password);
 186   3              }
 187   2              // å¦‚æœS15è¢«æŒ‰ä¸‹ä¸¤æ¬¡ï¼Œåˆ™è§†ä¸ºä¸ä¿®æ”¹å¯†ç ï¼Œç¨‹åºé€€å‡º
 188   2              if (S15_count >= 2)
 189   2              {
 190   3                  S15_count = 0;
 191   3                  return 1; 
 192   3              }
 193   2              // è‹¥æ˜¯å¯†ç ç¡®è®¤æ­£ç¡®ä½†ä¸è¿›è¡Œä»»ä½•æ“ä½œï¼Œåˆ™3såç¨‹åºè‡ªåŠ¨ç»“æŸ
 194   2              if (T0Count >= 3000)
 195   2              {
 196   3                  TR0 = 0; // åœæ­¢å®šæ—¶å™¨è®¡æ—¶
 197   3                  T0Count = 0;
 198   3                  return 1;
 199   3              }
 200   2          }
 201   1          return 0;
 202   1      }
 203          
 204          int main(void)
 205          {
 206   1          // AT24C02Init();
 207   1          LCD1602_Init();
 208   1          LCD_ShowString(1, 1, "Password:");
 209   1          LCD_ShowString(2, 1, "                ");
 210   1          ReadPassword();
 211   1      
 212   1          for (;;)
 213   1          {
 214   2              // æ¥æ”¶çŸ©é˜µé”®ç›˜è¿”å›çš„å€¼
 215   2              KeyNum = MatrixKey();
 216   2              // å¯†ç æ¨¡å¼
 217   2              if (PasswordModel()) // å‡½æ•°è¿”å›1æ—¶æ˜¯å¯†ç è¾“å…¥æ­£ç¡®ä¸”æ— åŠ¨ä½œæˆ–è€…è¾“å…¥æ­£ç¡®å¹¶ä¸”ä
             -¿®æ”¹äº†å¯†ç ï¼Œå¦åˆ™è¿”å›0ä¸€ç›´å¾ªç¯
 218   2                  goto Break;
 219   2          }
 220   1      Break:
 221   1          return 0;
 222   1      }
 223          
 224          void Timer0_Routine() interrupt 1
 225          {
 226   1          TL0 = 0x66;
 227   1          TH0 = 0xFC;
 228   1          T0Count++;
 229   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    552    ----
   CONSTANT SIZE    =     95    ----
   XDATA SIZE       =   ----    ----
C51 COMPILER V9.60.7.0   MAIN                                                              06/13/2023 14:15:47 PAGE 5   

   PDATA SIZE       =   ----    ----
   DATA SIZE        =      9       1
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      2    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
